<!doctype html>
<html>
    <head>
        <meta charset="utf-8">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <title>{{ title }}</title>
        <link rel="stylesheet" href="/stylesheets/foundation.min.css">
        <link rel="stylesheet" href="/stylesheets/font-awesome/css/font-awesome.min.css">
        <link rel="stylesheet" href="/stylesheets/tk.css">
        <script src="/javascript/jquery.js"></script>
        <script src="/javascript/modernizr.js"></script>
    </head>
    <body>
        <div class="full-size fixed">
            <div class="large-12 columns medium-12 columns header">
                <a href="/" class="logo"><img src="/images/taskwetu.png"></a>
                <ul class="header-ctrls show-for-medium-up">
                    <li><a class="notifications notMenTrigger" data-show="notifications"><i class="fa fa-inbox"></i></a></li>
                    <li><a class="tasks" href="create.html">New Task</a></li>
                    <li><a class="profile-img notMenTrigger" data-show="menu"><img src="{{ profile_image }}"></a></li>
                </ul>
                <ul class="header-ctrls show-for-small-only">
                    <li><a class="notifications notMenTrigger" data-show="notifications"><i class="fa fa-inbox"></i></a></li>
                    <li><a class="profile-img notMenTrigger" data-show="menu"><img src="{{ user.profile_image }}"></a></li>
                </ul>
                <div class="not-men" id="notMen">
                    <ul id="menu" class="menu">
                        <li>{{ display_name }}<i class="fa fa-times-circle notMenClose"></i></li>
                        <li><a href="/myAccount"><i class="fa fa-user"></i>My Account</a></li>
                        <li><a href="/newTask"><i class="fa fa-plus-square"></i>New Task</a></li>
                        <li><a href="/myTasks"><i class="fa fa-tasks"></i>My Tasks</a></li>
                        <li><a href="/support"><i class="fa fa-support"></i>Support</a></li>
                        <li><a href="/logout"><i class="fa fa-sign-out"></i>Logout</a></li>
                    </ul>
                    <ul id="notifications" class="notifications">
                        <li>Notifications<i class="fa fa-times-circle notMenClose"></i></li>
                    </ul>
                </div>
                <div class="notification-d" id="notification">
                    <i class="fa fa-times-circle notification-d-close"></i>
                    <p class="notification"></p>
                </div>
            </div>
        </div>
        <div class="large-12 columns medium-12 columns app-wrapper">
            <div class="row">
                <div class="large-12 columns medium-12 columns my-tasks-wrapper">
                    <div id="tDetailModal" class="reveal-modal large expand-view" data-reveal>
                        
                    </div>
                    <div class="large-12 columns medium-12 columns t-table-wrapper" id="t-table-wrapper">
                        
                    </div>
                </div>
            </div>
        </div>
        <script src="/javascript/foundation.min.js"></script>
        <script src="/javascript/moment.js"></script>
        <script src="/javascript/handlebars.js"></script>
        <script src="/javascript/tkTemplates.js"></script>
        <script src="/javascript/tk.js"></script>
        <script>
            $(document).foundation();
        </script>
        <script>
            $(function(){

                function loadTasks(userId){
                    url = '/api/task/getTasksByUserId/'+userId;
                    page = $('#t-table-wrapper');
                    tasksTable = Handlebars.templates['taskstable'];

                    $.getJSON(url, function(data){
                        console.log(data);
                        page.html(tasksTable({'task' : data}));

                        tableActions();

                    });
                }

                function tableActions(){
                    var unpaidTask = $('.unpaid-button').parent(),
                        cTaskInput = $('.ctask-input'),
                        cTaskUrgent = $('.ctask-urgent'),
                        taskTitle = $('.task-title');

                    unpaidTask.on('mouseenter', function(e){
                        $(e.target.children[0].firstChild).removeClass('fa-times-circle').addClass('fa-check-circle');
                        e.target.children[0].childNodes[1].nodeValue = 'Pay now - ';
                    });

                    unpaidTask.on('mouseleave', function(e){
                        $(e.target.children[0].firstChild).removeClass('fa-check-circle').addClass('fa-times-circle');
                        e.target.children[0].childNodes[1].nodeValue = 'Unpaid - ';
                    });

                    taskTitle.on('click', function(e){
                        taskId = e.target.dataset.id;
                        url = '/api/task/getTaskById/'+taskId;
                        page = $('#tDetailModal');
                        tasksDetailed = Handlebars.templates['taskdetailed'];

                        $.getJSON(url, function(data){
                            formatData(data);
                            //page.html(tasksDetailed(hData));
                        });
                    });
                }

                function formatData(data){
                    console.log(data);
                }

                Handlebars.registerHelper('formatDate', function(time){
                    result = moment(time).fromNow();
                    return new Handlebars.SafeString(result);
                });

                loadTasks(1);
            });
        </script>
    </body>
</html>